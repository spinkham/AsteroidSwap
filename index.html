<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Asteroid Swap</title>
  <script src="phaser.min.js"></script>
  <style type="text/css">
    body {
      margin: 0;
    }
  </style>
</head>

<body>

  <script type="text/javascript">
    var game = new Phaser.Game(800, 600, Phaser.AUTO, '', {
      preload: preload,
      create: create,
      update: update
    });

    function preload() {

      game.load.image('star', 'assets/star.png');
      game.load.image('wave', 'assets/wave.png');
      game.load.tilemap('biomes', 'assets/Biomes.json', null, Phaser.Tilemap.TILED_JSON);
      game.load.image('asteroids-32x30', 'assets/asteroids/asteroids-32x30.png')

    }

    var player;
    var cursors;
    var map;

    var stars;
    var score = 0;
    var scoreText;

    function create() {

      map = game.add.tilemap('biomes');
      map.addTilesetImage('asteroids-32x30');

      layer = map.createLayer('Biome1');
      layer.resizeWorld();

      game.physics.startSystem(Phaser.Physics.ARCADE);

      player = game.add.sprite(200, 300, 'wave')
      game.physics.arcade.enable(player);
      player.body.collideWorldBounds = true;
      game.camera.follow(player);

      stars = game.add.group();
      stars.enableBody = true;

      for (var i = 0; i < 12; i++) {
        var star = stars.create(i * 70, 450, 'star');
        star.scale.setTo(2, 2);
      }

      cursors = game.input.keyboard.createCursorKeys();

      scoreText = game.add.text(16, 16, 'Score: 0', {
        fontSize: '32px',
        fill: '#000'
      });

    }

    function update() {

      //  Checks to see if the player overlaps with any of the stars, if he does call the collectStar function
      game.physics.arcade.overlap(player, stars, collectStar, null, this);

      player.body.velocity.x = 0;

      if (cursors.left.isDown) {
        //  Move to the left
        player.body.velocity.x = -150;
      } else if (cursors.right.isDown) {
        //  Move to the right
        player.body.velocity.x = 150;
      }

      stars.forEachAlive(function(star) {
        if (star.y <= 450) {
          star.body.velocity.y = 50;
        }
        if (star.y >= 500) {
          star.body.velocity.y = -50;
        }
      });
    }


    function collectStar(player, star) {
      star.kill();
      score += 10;
      scoreText.text = 'Score: ' + score;
    }
  </script>

</body>

</html>
