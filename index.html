<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Asteroid Swap</title>
  <script src="phaser.min.js"></script>
  <style type="text/css">
    body {
      margin: 0;
    }
  </style>
</head>

<body>

  <script type="text/javascript">
    var game = new Phaser.Game(800, 600, Phaser.AUTO, '', {
      preload: preload,
      create: create,
      update: update
    });

    function preload() {

      game.load.image('star', 'assets/star.png');
      game.load.image('wave', 'assets/wave.png');
      game.load.tilemap('biomes', 'assets/Biomes.json', null, Phaser.Tilemap.TILED_JSON);
      game.load.image('asteroids-32x30', 'assets/asteroids/asteroids-32x30.png')

    }

    var player;
    var spacebar;
    var map;
    var direction = 'up';

    var stars;
    var score = 0;
    var scoreText;

    function create() {

      game.physics.startSystem(Phaser.Physics.ARCADE);

      map = game.add.tilemap('biomes');
      map.addTilesetImage('asteroids-32x30');

      layer = map.createLayer('Biome1');
      layer.resizeWorld();

      map.setCollisionBetween(1,102, true, layer);

      player = game.add.sprite(200, 300, 'wave');
      player.anchor.setTo(0.5, 0.5);
      game.physics.arcade.enable(player);
      player.body.collideWorldBounds = true;
      game.camera.follow(player);

      stars = game.add.group();
      stars.enableBody = true;

      //for (var i = 0; i < 12; i++) {
      //  var star = stars.create(i * 70, 450, 'star');
      //  star.scale.setTo(2, 2);
      //}

      spacebar = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
      spacebar.onDown.add(reverseDirection,this);

      scoreText = game.add.text(16, 16, 'Score: 0', {
        fontSize: '32px',
        fill: '#888'
      });
      scoreText.fixedToCamera = true;
      player.body.velocity.x = 0;

    }

    function update() {
      game.physics.arcade.overlap(player, stars, collectStar, null, this);
      game.physics.arcade.collide(player, layer, test1, null, this);

      stars.forEachAlive(function(star) {
        if (star.y <= 450) {
          star.body.velocity.y = 50;
        }
        if (star.y >= 500) {
          star.body.velocity.y = -50;
        }
      });
    }


    function collectStar(player, star) {
      star.kill();
      score += 10;
      scoreText.text = 'Score: ' + score;
    }

    function test1(player, star) {
      scoreText.text = 'Collide';
    }

    function reverseDirection(){
      if (player.body.velocity.x ==0){
        player.body.velocity.x = 75;
        player.body.velocity.y = -75;
        player.angle = -45;
      } else if (direction=='up'){
        direction='down';
        player.body.velocity.x = 75;
        player.body.velocity.y = 75;
        player.angle = 45;
      } else {
        direction='up';
        player.body.velocity.x = 75;
        player.body.velocity.y = -75;
        player.angle = -45;
      }
    }
  </script>

</body>

</html>
